<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aethrix åŠ©æ‰‹æµ‹è¯•é¡µé¢</title>
    <link rel="stylesheet" href="style.css?v=193">
    <style>
        body {
            margin: 0;
            padding: 40px;
            font-family: 'Inter', sans-serif;
            background: #f5f5f5;
        }
        
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            margin-bottom: 20px;
            color: #1a1a1a;
        }
        
        .test-info {
            background: #f0f0f0;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
        }
        
        .test-info h2 {
            margin-top: 0;
            font-size: 18px;
            color: #333;
        }
        
        .test-info p {
            margin: 10px 0;
            color: #666;
        }
        
        .test-buttons {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }
        
        .test-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .test-btn-primary {
            background: #1a1a1a;
            color: white;
        }
        
        .test-btn-primary:hover {
            background: #333;
        }
        
        .test-btn-secondary {
            background: #e0e0e0;
            color: #333;
        }
        
        .test-btn-secondary:hover {
            background: #d0d0d0;
        }
        
        .debug-log {
            background: #1a1a1a;
            color: #00ff00;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
        }
        
        .debug-log p {
            margin: 5px 0;
        }
        
        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 24px;
            background: #1a1a1a;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            z-index: 1000;
        }
        
        [data-theme="dark"] body {
            background: #1a1a1a;
        }
        
        [data-theme="dark"] .test-container {
            background: #2a2a2a;
            color: #f0f0f0;
        }
        
        [data-theme="dark"] h1 {
            color: #f0f0f0;
        }
        
        [data-theme="dark"] .test-info {
            background: #333;
        }
        
        [data-theme="dark"] .test-info h2 {
            color: #f0f0f0;
        }
        
        [data-theme="dark"] .test-info p {
            color: #ccc;
        }
        
        [data-theme="dark"] .test-btn-primary {
            background: #00ffcc;
            color: #1a1a1a;
        }
        
        [data-theme="dark"] .test-btn-primary:hover {
            background: #00e6b8;
        }
        
        [data-theme="dark"] .test-btn-secondary {
            background: #444;
            color: #f0f0f0;
        }
        
        [data-theme="dark"] .test-btn-secondary:hover {
            background: #555;
        }
        
        [data-theme="dark"] .theme-toggle {
            background: #00ffcc;
            color: #1a1a1a;
        }
    </style>
</head>
<body data-theme="light">
    <button class="theme-toggle" onclick="toggleTheme()">åˆ‡æ¢ä¸»é¢˜</button>
    
    <div class="test-container">
        <h1>ğŸ¤– Aethrix åŠ©æ‰‹æµ‹è¯•é¡µé¢</h1>
        
        <div class="test-info">
            <h2>æµ‹è¯•è¯´æ˜</h2>
            <p>1. ç‚¹å‡»å³ä¸‹è§’çš„ "A" å›¾æ ‡åº”è¯¥æ‰“å¼€èŠå¤©æ¡†</p>
            <p>2. èŠå¤©æ¡†åº”è¯¥æ˜¾ç¤ºåœ¨å›¾æ ‡ä¸Šæ–¹</p>
            <p>3. å¯ä»¥åˆ‡æ¢ç™½å¤©/å¤œæ™šæ¨¡å¼æµ‹è¯•æ ·å¼</p>
            <p>4. æŸ¥çœ‹ä¸‹æ–¹è°ƒè¯•æ—¥å¿—äº†è§£è¯¦ç»†ä¿¡æ¯</p>
        </div>
        
        <div class="test-buttons">
            <button class="test-btn test-btn-primary" onclick="testOpenChat()">æµ‹è¯•æ‰“å¼€èŠå¤©æ¡†</button>
            <button class="test-btn test-btn-secondary" onclick="testCloseChat()">æµ‹è¯•å…³é—­èŠå¤©æ¡†</button>
            <button class="test-btn test-btn-secondary" onclick="checkModalState()">æ£€æŸ¥æ¨¡æ€æ¡†çŠ¶æ€</button>
            <button class="test-btn test-btn-secondary" onclick="clearLog()">æ¸…é™¤æ—¥å¿—</button>
        </div>
        
        <div class="debug-log" id="debug-log">
            <p>ğŸ“‹ è°ƒè¯•æ—¥å¿—ï¼š</p>
        </div>
    </div>
    
    <!-- Aethrix AI Assistant -->
    <div class="aethrix-assistant" id="aethrix-assistant" aria-label="Aethrix åŠ©æ‰‹">
        <!-- Floating Icon -->
        <div class="aethrix-icon" id="aethrix-icon" onclick="toggleAethrixChat()" role="button" tabindex="0" aria-label="æ‰“å¼€AIåŠ©æ‰‹" aria-expanded="false">
            <div class="aethrix-icon-inner">
                <span class="aethrix-logo">A</span>
            </div>
            <div class="aethrix-pulse"></div>
        </div>
        <!-- Speech Bubble on Hover -->
        <div class="aethrix-speech" id="aethrix-speech">
            <span>æœ‰ä»€ä¹ˆå¯ä»¥å¸®æ‚¨ï¼Ÿ</span>
        </div>
    </div>
    
    <!-- Aethrix Chat Modal -->
    <div class="aethrix-chat-modal" id="aethrix-chat-modal" role="dialog" aria-labelledby="aethrix-chat-title" aria-hidden="true">
        <div class="aethrix-chat-container">
            <div class="aethrix-chat-header">
                <div class="aethrix-chat-header-left">
                    <div class="aethrix-chat-avatar">A</div>
                    <div class="aethrix-chat-title">
                        <h3 id="aethrix-chat-title">Aethrix åŠ©æ‰‹</h3>
                        <div class="aethrix-chat-status">åœ¨çº¿</div>
                    </div>
                </div>
                <button class="aethrix-chat-close" id="aethrix-chat-close" aria-label="å…³é—­èŠå¤©">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="aethrix-chat-messages" id="aethrix-chat-messages">
                <div class="aethrix-message aethrix-message--bot">
                    <div class="aethrix-message-avatar">A</div>
                    <div class="aethrix-message-content">
                        <p>ä½ å¥½ï¼æˆ‘æ˜¯ Aethrix åŠ©æ‰‹ ğŸ‘‹</p>
                        <p>æœ‰ä»€ä¹ˆå¯ä»¥å¸®æ‚¨çš„å—ï¼Ÿ</p>
                    </div>
                </div>
            </div>
            <div class="aethrix-chat-input-container">
                <input type="text" class="aethrix-chat-input" id="aethrix-chat-input" placeholder="è¾“å…¥æ¶ˆæ¯..." aria-label="è¾“å…¥æ¶ˆæ¯">
                <button class="aethrix-chat-send" id="aethrix-chat-send" aria-label="å‘é€æ¶ˆæ¯">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="22" y1="2" x2="11" y2="13"></line>
                        <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                    </svg>
                </button>
            </div>
        </div>
    </div>
    
    <script>
        // Debug logging
        function log(message, type = 'info') {
            const logDiv = document.getElementById('debug-log');
            const timestamp = new Date().toLocaleTimeString();
            const icon = type === 'error' ? 'âŒ' : type === 'success' ? 'âœ…' : 'â„¹ï¸';
            const p = document.createElement('p');
            p.textContent = `[${timestamp}] ${icon} ${message}`;
            logDiv.appendChild(p);
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(`[${timestamp}] ${message}`);
        }
        
        function clearLog() {
            const logDiv = document.getElementById('debug-log');
            logDiv.innerHTML = '<p>ğŸ“‹ è°ƒè¯•æ—¥å¿—ï¼š</p>';
        }
        
        // Theme toggle
        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            document.body.setAttribute('data-theme', newTheme);
            log(`ä¸»é¢˜åˆ‡æ¢åˆ°: ${newTheme}`);
        }
        
        // Aethrix Assistant Functions
        function toggleAethrixChat() {
            log('toggleAethrixChat è¢«è°ƒç”¨');
            const modal = document.getElementById('aethrix-chat-modal');
            const icon = document.getElementById('aethrix-icon');
            
            if (!modal) {
                log('æ¨¡æ€æ¡†æœªæ‰¾åˆ°ï¼', 'error');
                return;
            }
            
            log(`æ¨¡æ€æ¡†å½“å‰çŠ¶æ€: ${modal.classList.contains('active') ? 'æ‰“å¼€' : 'å…³é—­'}`);
            
            if (modal.classList.contains('active')) {
                log('å…³é—­æ¨¡æ€æ¡†');
                closeAethrixChat();
            } else {
                log('æ‰“å¼€æ¨¡æ€æ¡†');
                modal.classList.add('active');
                if (icon) {
                    icon.classList.add('active');
                    icon.setAttribute('aria-expanded', 'true');
                }
                modal.setAttribute('aria-hidden', 'false');
                
                const input = document.getElementById('aethrix-chat-input');
                if (input) {
                    input.focus();
                    log('è¾“å…¥æ¡†å·²èšç„¦');
                }
                
                log(`æ¨¡æ€æ¡†å·²æ‰“å¼€ï¼ŒclassList: ${Array.from(modal.classList).join(', ')}`, 'success');
                
                // Check computed styles
                const computedStyle = window.getComputedStyle(modal);
                log(`æ¨¡æ€æ¡†è®¡ç®—æ ·å¼ - opacity: ${computedStyle.opacity}, visibility: ${computedStyle.visibility}, zIndex: ${computedStyle.zIndex}`);
            }
        }
        
        function closeAethrixChat() {
            log('closeAethrixChat è¢«è°ƒç”¨');
            const modal = document.getElementById('aethrix-chat-modal');
            const icon = document.getElementById('aethrix-icon');
            
            if (modal) {
                modal.classList.remove('active');
                modal.setAttribute('aria-hidden', 'true');
                log('æ¨¡æ€æ¡†å·²å…³é—­', 'success');
            }
            
            if (icon) {
                icon.classList.remove('active');
                icon.setAttribute('aria-expanded', 'false');
            }
        }
        
        // Test functions
        function testOpenChat() {
            log('=== å¼€å§‹æµ‹è¯•æ‰“å¼€èŠå¤©æ¡† ===');
            toggleAethrixChat();
        }
        
        function testCloseChat() {
            log('=== å¼€å§‹æµ‹è¯•å…³é—­èŠå¤©æ¡† ===');
            closeAethrixChat();
        }
        
        function checkModalState() {
            log('=== æ£€æŸ¥æ¨¡æ€æ¡†çŠ¶æ€ ===');
            const modal = document.getElementById('aethrix-chat-modal');
            const icon = document.getElementById('aethrix-icon');
            
            if (!modal) {
                log('æ¨¡æ€æ¡†å…ƒç´ ä¸å­˜åœ¨ï¼', 'error');
                return;
            }
            
            log(`æ¨¡æ€æ¡† classList: ${Array.from(modal.classList).join(', ')}`);
            log(`æ¨¡æ€æ¡† aria-hidden: ${modal.getAttribute('aria-hidden')}`);
            
            const computedStyle = window.getComputedStyle(modal);
            log(`è®¡ç®—æ ·å¼ - display: ${computedStyle.display}`);
            log(`è®¡ç®—æ ·å¼ - opacity: ${computedStyle.opacity}`);
            log(`è®¡ç®—æ ·å¼ - visibility: ${computedStyle.visibility}`);
            log(`è®¡ç®—æ ·å¼ - zIndex: ${computedStyle.zIndex}`);
            log(`è®¡ç®—æ ·å¼ - position: ${computedStyle.position}`);
            log(`è®¡ç®—æ ·å¼ - bottom: ${computedStyle.bottom}`);
            log(`è®¡ç®—æ ·å¼ - right: ${computedStyle.right}`);
            log(`è®¡ç®—æ ·å¼ - transform: ${computedStyle.transform}`);
            log(`è®¡ç®—æ ·å¼ - pointerEvents: ${computedStyle.pointerEvents}`);
            
            if (icon) {
                log(`å›¾æ ‡ classList: ${Array.from(icon.classList).join(', ')}`);
                log(`å›¾æ ‡ aria-expanded: ${icon.getAttribute('aria-expanded')}`);
            }
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            log('é¡µé¢åŠ è½½å®Œæˆ');
            
            const closeBtn = document.getElementById('aethrix-chat-close');
            const input = document.getElementById('aethrix-chat-input');
            const sendBtn = document.getElementById('aethrix-chat-send');
            const messages = document.getElementById('aethrix-chat-messages');
            const icon = document.getElementById('aethrix-icon');
            
            if (closeBtn) {
                closeBtn.addEventListener('click', closeAethrixChat);
                log('å…³é—­æŒ‰é’®äº‹ä»¶å·²ç»‘å®š');
            }
            
            if (icon) {
                icon.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        toggleAethrixChat();
                    }
                });
                log('å›¾æ ‡é”®ç›˜äº‹ä»¶å·²ç»‘å®š');
            }
            
            // Send message
            function sendMessage() {
                const text = input.value.trim();
                if (!text) return;
                
                log(`å‘é€æ¶ˆæ¯: ${text}`);
                
                const userMsg = document.createElement('div');
                userMsg.className = 'aethrix-message aethrix-message--user';
                userMsg.innerHTML = `
                    <div class="aethrix-message-avatar">æˆ‘</div>
                    <div class="aethrix-message-content"><p>${escapeHtml(text)}</p></div>
                `;
                messages.appendChild(userMsg);
                input.value = '';
                messages.scrollTop = messages.scrollHeight;
                
                setTimeout(() => {
                    const botMsg = document.createElement('div');
                    botMsg.className = 'aethrix-message aethrix-message--bot';
                    botMsg.innerHTML = `
                        <div class="aethrix-message-avatar">A</div>
                        <div class="aethrix-message-content"><p>æµ‹è¯•å›å¤ï¼šæ”¶åˆ°æ‚¨çš„æ¶ˆæ¯ "${text}" ğŸš€</p></div>
                    `;
                    messages.appendChild(botMsg);
                    messages.scrollTop = messages.scrollHeight;
                    log('æœºå™¨äººå·²å›å¤');
                }, 800);
            }
            
            function escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }
            
            if (sendBtn) {
                sendBtn.addEventListener('click', sendMessage);
                log('å‘é€æŒ‰é’®äº‹ä»¶å·²ç»‘å®š');
            }
            
            if (input) {
                input.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') sendMessage();
                });
                log('è¾“å…¥æ¡†å›è½¦äº‹ä»¶å·²ç»‘å®š');
            }
            
            // Close on escape
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    const modal = document.getElementById('aethrix-chat-modal');
                    if (modal && modal.classList.contains('active')) {
                        closeAethrixChat();
                        log('æŒ‰ ESC å…³é—­èŠå¤©æ¡†');
                    }
                }
            });
            
            log('æ‰€æœ‰äº‹ä»¶ç›‘å¬å™¨å·²åˆå§‹åŒ–', 'success');
            checkModalState();
        });
    </script>
</body>
</html>
