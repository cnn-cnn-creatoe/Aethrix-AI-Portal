<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Skill Buttons Test - æŸ¥çœ‹è¯¦æƒ…æŒ‰é’®æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        h1 {
            color: #333;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #0066cc;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
            font-size: 13px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            background: #0066cc;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }
        button:hover {
            background: #0052a3;
        }
        .checklist {
            list-style: none;
            padding: 0;
        }
        .checklist li {
            padding: 8px;
            margin: 5px 0;
            background: #f8f9fa;
            border-left: 3px solid #6c757d;
        }
        .checklist li.pass {
            border-left-color: #28a745;
            background: #d4edda;
        }
        .checklist li.fail {
            border-left-color: #dc3545;
            background: #f8d7da;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª Skill æŒ‰é’®åŠŸèƒ½æµ‹è¯•</h1>
    
    <div class="test-section">
        <div class="test-title">ğŸ“‹ æµ‹è¯•æ¸…å•</div>
        <ul class="checklist" id="checklist">
            <li id="check-api">â³ 1. APIè¿æ¥æµ‹è¯• - è·å–skillæ•°æ®</li>
            <li id="check-count">â³ 2. æ•°é‡éªŒè¯ - åº”è¯¥æ˜¾ç¤º8ä¸ªskill</li>
            <li id="check-filter">â³ 3. è¿‡æ»¤éªŒè¯ - ä¸åŒ…å«"æ•´åˆä»“åº“"ç±»åˆ«</li>
            <li id="check-detail-btn">â³ 4. æŸ¥çœ‹è¯¦æƒ…æŒ‰é’® - æ¯ä¸ªå¡ç‰‡éƒ½æœ‰</li>
            <li id="check-copy-zh">â³ 5. ä¸­æ–‡æç¤ºè¯æŒ‰é’® - å­˜åœ¨æ—¶æ˜¾ç¤º</li>
            <li id="check-copy-en">â³ 6. English PromptæŒ‰é’® - å­˜åœ¨æ—¶æ˜¾ç¤º</li>
            <li id="check-source">â³ 7. æºä»£ç é“¾æ¥ - å­˜åœ¨æ—¶æ˜¾ç¤º</li>
        </ul>
    </div>

    <div class="test-section">
        <div class="test-title">ğŸ”§ è‡ªåŠ¨æµ‹è¯•</div>
        <button onclick="runAllTests()">è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
        <button onclick="location.reload()">é‡æ–°åŠ è½½</button>
        <div id="test-output"></div>
    </div>

    <div class="test-section">
        <div class="test-title">ğŸ“Š æµ‹è¯•ç»“æœ</div>
        <div id="results"></div>
    </div>

    <div class="test-section">
        <div class="test-title">ğŸ”— å¿«é€Ÿé“¾æ¥</div>
        <button onclick="window.open('/tools.html', '_blank')">æ‰“å¼€ Tools é¡µé¢</button>
        <button onclick="window.open('http://localhost:4005/', '_blank')">æ‰“å¼€ Skill ä¸»é¡µ</button>
    </div>

    <script>
        let testResults = {
            api: false,
            count: false,
            filter: false,
            detailBtn: false,
            copyZh: false,
            copyEn: false,
            source: false
        };

        function updateChecklist(id, status, message = '') {
            const item = document.getElementById(id);
            if (!item) return;
            
            item.className = status ? 'pass' : 'fail';
            const icon = status ? 'âœ…' : 'âŒ';
            const text = item.textContent.split(' - ')[0].replace(/^[â³âœ…âŒ]\s*/, '');
            item.textContent = `${icon} ${text}${message ? ' - ' + message : ''}`;
        }

        function logResult(message, type = 'info') {
            const output = document.getElementById('test-output');
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            output.appendChild(div);
        }

        async function runAllTests() {
            document.getElementById('test-output').innerHTML = '';
            document.getElementById('results').innerHTML = '<div class="info">æµ‹è¯•è¿›è¡Œä¸­...</div>';
            
            logResult('å¼€å§‹æµ‹è¯•...', 'info');
            
            try {
                // Test 1: API Connection
                logResult('æµ‹è¯• 1: æ£€æŸ¥APIè¿æ¥...', 'info');
                const response = await fetch('/api/skill-proxy/skills?per_page=20');
                
                if (!response.ok) {
                    throw new Error(`APIè¿”å›é”™è¯¯: ${response.status}`);
                }
                
                testResults.api = true;
                updateChecklist('check-api', true, 'APIè¿æ¥æˆåŠŸ');
                logResult('âœ… APIè¿æ¥æˆåŠŸ', 'success');
                
                const data = await response.json();
                const allSkills = data.data?.skills || data.skills || [];
                logResult(`è·å–åˆ° ${allSkills.length} ä¸ªskills`, 'info');
                
                // Test 2: Filter repositories
                logResult('æµ‹è¯• 2: è¿‡æ»¤"æ•´åˆä»“åº“"ç±»åˆ«...', 'info');
                const repositorySkills = allSkills.filter(s => s.category === 'repositories');
                const filteredSkills = allSkills.filter(s => s.category !== 'repositories');
                
                testResults.filter = repositorySkills.length > 0 || filteredSkills.length === allSkills.length;
                updateChecklist('check-filter', true, `è¿‡æ»¤æ‰ ${repositorySkills.length} ä¸ªä»“åº“`);
                logResult(`âœ… è¿‡æ»¤åå‰©ä½™ ${filteredSkills.length} ä¸ªskills`, 'success');
                
                // Test 3: Count check
                logResult('æµ‹è¯• 3: æ£€æŸ¥æ•°é‡ï¼ˆåº”è¯¥å–å‰8ä¸ªï¼‰...', 'info');
                const finalSkills = filteredSkills.slice(0, 8);
                testResults.count = finalSkills.length === 8;
                
                if (testResults.count) {
                    updateChecklist('check-count', true, `æ­£å¥½8ä¸ªskill`);
                    logResult('âœ… æ•°é‡æ­£ç¡®: 8ä¸ªskills', 'success');
                } else {
                    updateChecklist('check-count', false, `åªæœ‰${finalSkills.length}ä¸ª`);
                    logResult(`âŒ æ•°é‡ä¸è¶³: åªæœ‰${finalSkills.length}ä¸ªskills`, 'error');
                }
                
                // Test 4-7: Button checks
                logResult('æµ‹è¯• 4-7: æ£€æŸ¥æŒ‰é’®é…ç½®...', 'info');
                let detailBtnCount = 0;
                let copyZhCount = 0;
                let copyEnCount = 0;
                let sourceCount = 0;
                
                finalSkills.forEach(skill => {
                    // Every skill should have detail button
                    detailBtnCount++;
                    
                    // Count optional buttons
                    if (skill.system_prompt) copyZhCount++;
                    if (skill.system_prompt_en) copyEnCount++;
                    if (skill.source_url) sourceCount++;
                });
                
                testResults.detailBtn = detailBtnCount === 8;
                testResults.copyZh = copyZhCount > 0;
                testResults.copyEn = copyEnCount > 0;
                testResults.source = sourceCount > 0;
                
                updateChecklist('check-detail-btn', testResults.detailBtn, `${detailBtnCount}/8 æœ‰æŸ¥çœ‹è¯¦æƒ…æŒ‰é’®`);
                updateChecklist('check-copy-zh', testResults.copyZh, `${copyZhCount}/8 æœ‰ä¸­æ–‡æç¤ºè¯`);
                updateChecklist('check-copy-en', testResults.copyEn, `${copyEnCount}/8 æœ‰è‹±æ–‡æç¤ºè¯`);
                updateChecklist('check-source', testResults.source, `${sourceCount}/8 æœ‰æºä»£ç é“¾æ¥`);
                
                logResult(`âœ… æŸ¥çœ‹è¯¦æƒ…æŒ‰é’®: ${detailBtnCount}/8`, 'success');
                logResult(`âœ… ä¸­æ–‡æç¤ºè¯: ${copyZhCount}/8`, 'success');
                logResult(`âœ… è‹±æ–‡æç¤ºè¯: ${copyEnCount}/8`, 'success');
                logResult(`âœ… æºä»£ç é“¾æ¥: ${sourceCount}/8`, 'success');
                
                // Summary
                const passCount = Object.values(testResults).filter(v => v).length;
                const totalCount = Object.keys(testResults).length;
                
                const resultsDiv = document.getElementById('results');
                if (passCount === totalCount) {
                    resultsDiv.innerHTML = `
                        <div class="success">
                            <strong>ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼(${passCount}/${totalCount})</strong><br>
                            <br>
                            âœ… APIè¿æ¥æ­£å¸¸<br>
                            âœ… æ˜¾ç¤º8ä¸ªskill<br>
                            âœ… è¿‡æ»¤"æ•´åˆä»“åº“"ç±»åˆ«<br>
                            âœ… æ‰€æœ‰å¡ç‰‡éƒ½æœ‰"æŸ¥çœ‹è¯¦æƒ…"æŒ‰é’®<br>
                            âœ… å¤åˆ¶æŒ‰é’®å’Œæºä»£ç é“¾æ¥æ­£ç¡®æ˜¾ç¤º<br>
                            <br>
                            <strong>ä¸‹ä¸€æ­¥:</strong> è®¿é—® <a href="/tools.html" target="_blank">Toolsé¡µé¢</a> è¿›è¡Œå®é™…æµ‹è¯•
                        </div>
                    `;
                    logResult(`ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼(${passCount}/${totalCount})`, 'success');
                } else {
                    resultsDiv.innerHTML = `
                        <div class="error">
                            <strong>âš ï¸ éƒ¨åˆ†æµ‹è¯•å¤±è´¥ (${passCount}/${totalCount})</strong><br>
                            è¯·æ£€æŸ¥ä¸Šé¢çš„è¯¦ç»†ä¿¡æ¯
                        </div>
                    `;
                    logResult(`âš ï¸ éƒ¨åˆ†æµ‹è¯•å¤±è´¥ (${passCount}/${totalCount})`, 'error');
                }
                
                // Show skill details
                logResult('', 'info');
                logResult('ğŸ“‹ Skillåˆ—è¡¨:', 'info');
                finalSkills.forEach((skill, i) => {
                    logResult(`${i + 1}. ${skill.name} (${skill.category})`, 'info');
                });
                
            } catch (error) {
                logResult(`âŒ æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                document.getElementById('results').innerHTML = `
                    <div class="error">
                        <strong>âŒ æµ‹è¯•å¤±è´¥</strong><br>
                        ${error.message}
                    </div>
                `;
                
                updateChecklist('check-api', false, error.message);
            }
        }

        // Auto-run tests on page load
        window.addEventListener('load', () => {
            setTimeout(runAllTests, 500);
        });
    </script>
</body>
</html>
